#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ð³Ð¾ ÑÐ»ÐµÐ¶ÐµÐ½Ð¸Ñ Ð·Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð¸ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° GitHub

cd "/Users/admin/Desktop/ÐÐ¾Ð²Ð°Ñ Ð¿Ð°Ð¿ÐºÐ°"

echo "ðŸ‘€ ÐÐ²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¾Ðµ ÑÐ»ÐµÐ¶ÐµÐ½Ð¸Ðµ Ð·Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸..."
echo "ðŸ“¤ Ð˜Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ Ð±ÑƒÐ´ÑƒÑ‚ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°Ñ‚ÑŒÑÑ Ð½Ð° GitHub"
echo "â¹ï¸  ÐÐ°Ð¶Ð¼Ð¸Ñ‚Ðµ Ctrl+C Ñ‡Ñ‚Ð¾Ð±Ñ‹ Ð¾ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚ÑŒ"
echo ""

# Ð¤ÑƒÐ½ÐºÑ†Ð¸Ñ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ð¹
upload_changes() {
    echo ""
    echo "ðŸ”„ ÐžÐ±Ð½Ð°Ñ€ÑƒÐ¶ÐµÐ½Ñ‹ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ, Ð·Ð°Ð³Ñ€ÑƒÐ¶Ð°ÑŽ Ð½Ð° GitHub..."
    
    git add .
    COMMIT_MSG="ÐÐ²Ñ‚Ð¾Ð¾Ð±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ: $(date '+%Y-%m-%d %H:%M:%S')"
    git commit -m "$COMMIT_MSG" > /dev/null 2>&1
    git push origin main > /dev/null 2>&1
    
    if [ $? -eq 0 ]; then
        echo "âœ… Ð—Ð°Ð³Ñ€ÑƒÐ¶ÐµÐ½Ð¾: $(date '+%H:%M:%S')"
    else
        echo "âŒ ÐžÑˆÐ¸Ð±ÐºÐ° Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸: $(date '+%H:%M:%S')"
    fi
}

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ Ð½Ð°Ð»Ð¸Ñ‡Ð¸Ðµ fswatch
if command -v fswatch &> /dev/null; then
    echo "âœ… Ð˜ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÑ‚ÑÑ fswatch Ð´Ð»Ñ ÑÐ»ÐµÐ¶ÐµÐ½Ð¸Ñ"
    echo ""
    # Ð¡Ð»ÐµÐ´Ð¸Ð¼ Ð·Ð° Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸ÑÐ¼Ð¸ Ð² Ñ„Ð°Ð¹Ð»Ð°Ñ… (Ð¸ÑÐºÐ»ÑŽÑ‡Ð°ÐµÐ¼ .git Ð¸ ÑÐ»ÑƒÐ¶ÐµÐ±Ð½Ñ‹Ðµ Ñ„Ð°Ð¹Ð»Ñ‹)
    fswatch -o . | while read f; do
        upload_changes
    done
else
    echo "âš ï¸  fswatch Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½, Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·ÑƒÐµÐ¼ Ð¿Ñ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼"
    echo "   Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð¸Ñ‚Ðµ: brew install fswatch"
    echo ""
    echo "ðŸ“ Ð ÐµÐ¶Ð¸Ð¼: Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 10 ÑÐµÐºÑƒÐ½Ð´"
    echo ""
    
    # ÐŸÑ€Ð¾ÑÑ‚Ð¾Ð¹ Ñ€ÐµÐ¶Ð¸Ð¼ - Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ°Ð¶Ð´Ñ‹Ðµ 10 ÑÐµÐºÑƒÐ½Ð´
    LAST_COMMIT=$(git rev-parse HEAD)
    
    while true; do
        sleep 10
        
        # ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐµÐ¼ ÐµÑÑ‚ÑŒ Ð»Ð¸ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ
        git add . > /dev/null 2>&1
        CURRENT_STATUS=$(git status --porcelain)
        
        if [ ! -z "$CURRENT_STATUS" ]; then
            upload_changes
        fi
    done
fi

