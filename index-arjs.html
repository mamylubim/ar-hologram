<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AR –ì–æ–ª–æ–≥—Ä–∞–º–º–∞ - AR.js –≤–µ—Ä—Å–∏—è</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üì±</text></svg>">
    <style>
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            font-family: Arial, sans-serif;
        }
        .info {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 15px;
            border-radius: 10px;
            z-index: 1000;
            font-size: 14px;
            max-width: 300px;
            line-height: 1.6;
        }
        .arjs-loader {
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 9999;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .arjs-loader div {
            text-align: center;
            font-size: 1.25em;
            color: white;
        }
        
        /* –°–∫—Ä—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ debug —ç–ª–µ–º–µ–Ω—Ç—ã AR.js */
        .a-enter-vr-button,
        .a-orientation-modal {
            display: none !important;
        }
        
        /* –ü–æ–∫–∞–∑—ã–≤–∞–µ–º canvas */
        a-scene canvas {
            display: block !important;
        }
    </style>
</head>
<body>
    <div class="info" id="info">
        –ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro<br>
        –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–∞—Ä–∫–µ—Ä–ª–µ—Å—Å —Ä–µ–∂–∏–º
    </div>
    
    <!-- Loader –ø–æ–∫–∞ AR.js –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è -->
    <div class="arjs-loader" id="loader">
        <div>–ó–∞–≥—Ä—É–∑–∫–∞ AR... –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –∫–∞–º–µ—Ä–µ</div>
    </div>
    
    <!-- A-Frame —Å—Ü–µ–Ω–∞ —Å AR.js -->
    <a-scene
        vr-mode-ui="enabled: false"
        renderer="logarithmicDepthBuffer: true;"
        embedded
        arjs="sourceType: webcam; videoTexture: true; debugUIEnabled: false; trackingMethod: best;"
    >
        <!-- –ú–∞—Ä–∫–µ—Ä Hiro (—Ä–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ –º–∞—Ä–∫–µ—Ä) -->
        <a-marker preset="hiro" raycaster="objects: .clickable" emitevents="true">
            <!-- –í–∏–¥–µ–æ –≥–æ–ª–æ–≥—Ä–∞–º–º–∞ –Ω–∞ –º–∞—Ä–∫–µ—Ä–µ -->
            <a-video
                src="#video-source"
                position="0 0.5 0"
                rotation="0 0 0"
                width="1.5"
                height="1.125"
                opacity="0.9"
                material="shader: flat; transparent: true;"
                geometry="primitive: plane"
                class="clickable"
                animation__float="property: position; to: 0 0.7 0; loop: true; dur: 2000; direction: alternate"
            ></a-video>
        </a-marker>
        
        <!-- –ú–∞—Ä–∫–µ—Ä–ª–µ—Å—Å —Ä–µ–∂–∏–º (–≤–∏–¥–µ–æ –≤ –≤–æ–∑–¥—É—Ö–µ) -->
        <a-entity id="rig" position="0 0 0">
            <a-video
                src="#video-source"
                position="0 1.5 -1.5"
                rotation="0 0 0"
                width="2"
                height="1.5"
                opacity="0.9"
                material="shader: flat; transparent: true;"
                geometry="primitive: plane"
                animation__float="property: position; to: 0 1.8 -1.5; loop: true; dur: 2000; direction: alternate"
            ></a-video>
        </a-entity>
        
        <!-- –í–∏–¥–µ–æ –∏—Å—Ç–æ—á–Ω–∏–∫ -->
        <video
            id="video-source"
            autoplay
            loop
            playsinline
            webkit-playsinline
            muted
            preload="auto"
            style="display: none;"
        >
            <source src="video.mp4" type="video/mp4">
            <source src="./video.mp4" type="video/mp4">
        </video>
        
        <!-- –ö–∞–º–µ—Ä–∞ -->
        <a-entity camera></a-entity>
    </a-scene>
    
    <!-- AR.js –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ - –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å—Ç–∞–±–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é -->
    <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
    <!-- Marker Based –≤–µ—Ä—Å–∏—è AR.js - —Å—Ç–∞–±–∏–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è 3.3.3 -->
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js@3.3.3/aframe/build/aframe-ar.js"></script>
    
    <script>
        // –°–∫—Ä—ã–≤–∞–µ–º loader –∫–æ–≥–¥–∞ AR.js –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
        const scene = document.querySelector('a-scene');
        const loader = document.getElementById('loader');
        const info = document.getElementById('info');
        
        scene.addEventListener('loaded', function() {
            console.log('‚úÖ A-Frame —Å—Ü–µ–Ω–∞ –∑–∞–≥—Ä—É–∂–µ–Ω–∞');
            setTimeout(() => {
                if (loader) {
                    loader.style.display = 'none';
                }
                if (info) {
                    info.textContent = '‚úÖ AR –≥–æ—Ç–æ–≤! –ù–∞–≤–µ–¥–∏—Ç–µ –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro (—Ä–∞—Å–ø–µ—á–∞—Ç–∞–π—Ç–µ —Å marker.html)';
                }
            }, 2000);
        });
        
        // –û–±—Ä–∞–±–æ—Ç–∫–∞ –º–∞—Ä–∫–µ—Ä–∞
        const marker = document.querySelector('a-marker');
        if (marker) {
            console.log('–ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω –≤ DOM');
            
            marker.addEventListener('markerFound', function() {
                console.log('‚úÖ –ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω!');
                if (info) {
                    info.textContent = '‚úÖ –ú–∞—Ä–∫–µ—Ä –Ω–∞–π–¥–µ–Ω! –ì–æ–ª–æ–≥—Ä–∞–º–º–∞ –∞–∫—Ç–∏–≤–Ω–∞';
                }
            });
            
            marker.addEventListener('markerLost', function() {
                console.log('‚ùå –ú–∞—Ä–∫–µ—Ä –ø–æ—Ç–µ—Ä—è–Ω');
                if (info) {
                    info.textContent = '–ù–∞–≤–µ–¥–∏—Ç–µ –∫–∞–º–µ—Ä—É –Ω–∞ –º–∞—Ä–∫–µ—Ä Hiro';
                }
            });
        } else {
            console.error('–ú–∞—Ä–∫–µ—Ä –Ω–µ –Ω–∞–π–¥–µ–Ω –≤ DOM!');
        }
        
        // –ó–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('video-source');
            
            if (!video) {
                console.error('–í–∏–¥–µ–æ —ç–ª–µ–º–µ–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω!');
                return;
            }
            
            // –£–±–µ–∂–¥–∞–µ–º—Å—è —á—Ç–æ –≤–∏–¥–µ–æ –∑–∞—Ü–∏–∫–ª–µ–Ω–æ
            video.loop = true;
            
            // –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∏–¥–µ–æ
            video.load();
            
            // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–ø—É—Å—Ç–∏—Ç—å —Å—Ä–∞–∑—É
            function startVideo() {
                if (video.readyState >= 2) {
                    const playPromise = video.play();
                    if (playPromise !== undefined) {
                        playPromise.then(() => {
                            console.log('‚úÖ –í–∏–¥–µ–æ –∑–∞–ø—É—â–µ–Ω–æ –∏ –∑–∞—Ü–∏–∫–ª–µ–Ω–æ');
                        }).catch(e => {
                            console.log('–ê–≤—Ç–æ–∑–∞–ø—É—Å–∫ –≤–∏–¥–µ–æ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω, –ø–æ–ø—Ä–æ–±—É—é –µ—â–µ —Ä–∞–∑:', e);
                            // –ü—Ä–æ–±—É–µ–º –µ—â–µ —Ä–∞–∑ —á–µ—Ä–µ–∑ –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É
                            setTimeout(startVideo, 500);
                        });
                    }
                } else {
                    // –í–∏–¥–µ–æ –µ—â–µ –Ω–µ –≥–æ—Ç–æ–≤–æ, –∂–¥–µ–º
                    setTimeout(startVideo, 200);
                }
            }
            
            video.addEventListener('canplay', function() {
                console.log('–í–∏–¥–µ–æ –≥–æ—Ç–æ–≤–æ –∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—é');
                startVideo();
            });
            
            video.addEventListener('canplaythrough', function() {
                console.log('–í–∏–¥–µ–æ –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≥—Ä—É–∂–µ–Ω–æ');
                startVideo();
            });
            
            video.addEventListener('ended', function() {
                // –ï—Å–ª–∏ –≤–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å (—Ö–æ—Ç—è loop –¥–æ–ª–∂–µ–Ω —Ä–∞–±–æ—Ç–∞—Ç—å), –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞–µ–º
                console.log('–í–∏–¥–µ–æ –∑–∞–∫–æ–Ω—á–∏–ª–æ—Å—å, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞—é...');
                video.currentTime = 0;
                video.play();
            });
            
            video.addEventListener('error', function(e) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ:', e);
                console.error('–í–∏–¥–µ–æ –ø—É—Ç—å:', video.currentSrc || video.src);
                if (info) {
                    info.textContent = '‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∏–¥–µ–æ. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª video.mp4';
                }
            });
            
            // –ù–∞—á–∏–Ω–∞–µ–º –ø–æ–ø—ã—Ç–∫–∏ –∑–∞–ø—É—Å–∫–∞
            startVideo();
        });
    </script>
</body>
</html>
